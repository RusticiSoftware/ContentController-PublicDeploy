{% if use_ssl %}

server {
       listen         80;
       server_name    {{ ServerName }};
       return         301 https://$server_name$request_uri;
}

server {
        listen 443 ssl;
        ssl on;
        ssl_certificate /etc/ssl/certs/{{ ssl_certificate }};
        ssl_certificate_key /etc/ssl/private/{{ ssl_key }};
        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         HIGH:!aNULL:!MD5;

{% elif not use_ssl %}

server {
        listen         80;
       
{% endif %}
        server_name    {{ ServerName }};
        location / {
            root {{ html_path }};
            index index.html index.htm;
            location ~* \.(htm|html)$ {
            expires 1m;
            }
        }

        location /ScormEngineInterface {
                access_log off;
                add_header 'Access-Control-Allow-Origin' "*";
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
                
                proxy_pass http://localhost:8081/ScormEngineInterface/;
                proxy_set_header  Host             $http_host;
                proxy_set_header  X-Real-IP        $remote_addr;
                proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
                proxy_set_header  X-Forwarded-Proto https;
        }

        #location /courses {
        #        proxy_pass http://localhost:8080/courses/;
        #        proxy_set_header  Host             $http_host;
        #        proxy_set_header  X-Real-IP        $remote_addr;
        #        proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
        #        proxy_set_header  X-Forwarded-Proto https;
        #}

        location /api {
                access_log off;
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
                add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

                proxy_pass http://localhost:8989/api;
                proxy_set_header  X-NginX-Proxy true;
                proxy_set_header  Host             $http_host;
                proxy_set_header  X-Real-IP        $remote_addr;
                proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
                proxy_set_header  X-Forwarded-Proto https;

        }

        location /ops {
                access_log off;

                proxy_pass http://localhost:8981/;
                proxy_set_header  Host             $http_host;
                proxy_set_header  X-Real-IP        $remote_addr;
                proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
                proxy_set_header  X-Forwarded-Proto https;
        }

        location /courses {
                access_log off;

                root {{ data_root }}/content;
        }
}
